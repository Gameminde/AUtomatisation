{% extends "layout_v3.html" %}

{% block content %}
<!-- Studio Toolbar (compact, inline with page) -->
<div class="studio-bar">
    <div class="flex-gap">
        <select id="format-select" class="glass" style="padding: 4px 10px; font-size: 0.8rem;">
            <option value="post">Post (4:5)</option>
            <option value="story">Story (9:16)</option>
            <option value="square">Square (1:1)</option>
        </select>
        <div class="engagement-meter" title="Predicted Engagement">
            <span>üî• 85/100</span>
        </div>
    </div>
    <div class="flex-gap">
        <div class="studio-toolbar">
            <button class="icon-btn" onclick="saveTemplate()" title="Save as Template">
                <i class="fa-solid fa-floppy-disk"></i>
            </button>
            <button class="icon-btn" onclick="engine.undo()" title="Undo (Ctrl+Z)">
                <i class="fa-solid fa-rotate-left"></i>
            </button>
            <button class="icon-btn" onclick="engine.redo()" title="Redo (Ctrl+Y)">
                <i class="fa-solid fa-rotate-right"></i>
            </button>
            <button class="icon-btn" onclick="engine.deleteSelected()" title="Delete (Del)">
                <i class="fa-solid fa-trash"></i>
            </button>
        </div>
        <button class="btn btn-primary-outline btn-sm" onclick="exportCanvas()">
            ‚¨áÔ∏è PNG
        </button>
        <button class="btn btn-primary btn-sm" onclick="publishContent()">
            üöÄ Publish
        </button>
    </div>
</div>

<!-- Studio Body: Canvas + Controls -->
<div class="studio-layout">
    <!-- CANVAS AREA -->
    <div class="studio-canvas-wrap">
        <canvas id="live-canvas"></canvas>
        <button id="magic-btn" class="magic-fab" onclick="triggerMagic()">
            ‚ú¶ Magic
        </button>
    </div>

    <!-- CONTROLS PANEL -->
    <div class="studio-controls">

        <!-- Viral Mode Toggle -->
        <div class="viral-toggle">
            <label class="switch">
                <input type="checkbox" id="viral-mode-check">
                <span class="slider round"></span>
            </label>
            <span class="viral-label">VIRAL MODE üöÄ</span>
        </div>

        <!-- Template Strip -->
        <div class="ctrl-group">
            <label>Template</label>
            <div id="template-strip" class="template-strip"></div>
        </div>

        <!-- Brand / Page Name -->
        <div class="ctrl-group">
            <label>Page Name</label>
            <input id="brand-input" class="input input-sm" type="text" value="@SmartEraPro" placeholder="@YourPageName">
        </div>

        <!-- Social Media Icons Selection -->
        <div class="ctrl-group">
            <label>Social Icons</label>
            <div class="social-picker" id="social-icons-picker">
                <label class="social-chip active" data-platform="instagram">
                    <input type="checkbox" checked hidden> <i class="fa-brands fa-instagram"></i>
                </label>
                <label class="social-chip active" data-platform="facebook">
                    <input type="checkbox" checked hidden> <i class="fa-brands fa-facebook-f"></i>
                </label>
                <label class="social-chip active" data-platform="x-twitter">
                    <input type="checkbox" checked hidden> <i class="fa-brands fa-x-twitter"></i>
                </label>
                <label class="social-chip" data-platform="youtube">
                    <input type="checkbox" hidden> <i class="fa-brands fa-youtube"></i>
                </label>
                <label class="social-chip" data-platform="tiktok">
                    <input type="checkbox" hidden> <i class="fa-brands fa-tiktok"></i>
                </label>
                <label class="social-chip" data-platform="linkedin">
                    <input type="checkbox" hidden> <i class="fa-brands fa-linkedin-in"></i>
                </label>
                <label class="social-chip" data-platform="snapchat">
                    <input type="checkbox" hidden> <i class="fa-brands fa-snapchat"></i>
                </label>
                <label class="social-chip" data-platform="threads">
                    <input type="checkbox" hidden> <i class="fa-brands fa-threads"></i>
                </label>
            </div>
        </div>

        <!-- Text Edit -->
        <div class="ctrl-group">
            <label>Hook / Title</label>
            <textarea id="text-input" class="input input-sm" rows="2" placeholder="Enter your hook..."></textarea>
        </div>

        <!-- Colors -->
        <div class="ctrl-group">
            <label>Text Color</label>
            <div class="flex-gap">
                <input type="color" id="text-color" value="#ffffff"
                    style="width: 28px; height: 24px; border: none; border-radius: 6px; cursor: pointer;">
                <span id="color-label"
                    style="font-family: monospace; font-size: 0.75rem; color: var(--text-dim);">#FFFFFF</span>
            </div>
        </div>

        <!-- Image Uploads -->
        <div class="ctrl-row">
            <button class="btn btn-secondary btn-sm" onclick="document.getElementById('bg-upload').click()">
                üñºÔ∏è BG
            </button>
            <input type="file" id="bg-upload" hidden onchange="handleBgUpload(event)">
            <button class="btn btn-secondary btn-sm" onclick="document.getElementById('photo-upload').click()">
                üì∑ Photo
            </button>
            <input type="file" id="photo-upload" hidden onchange="handlePhotoUpload(event)">
        </div>

        <!-- BG Intensity Slider -->
        <div id="bg-intensity-wrap" class="ctrl-group" style="display: none;">
            <label>BG Intensity</label>
            <div class="flex-gap">
                <input type="range" id="bg-intensity" min="0" max="100" value="100"
                    style="flex: 1; accent-color: var(--primary); cursor: pointer;">
                <span id="bg-intensity-value"
                    style="font-family: monospace; font-size: 0.75rem; color: var(--text-dim);">100%</span>
            </div>
        </div>

        <!-- AI Tools -->
        <div class="ctrl-row">
            <button class="btn btn-secondary btn-sm" onclick="alert('Connect API Key for Remove BG')">
                ‚úÇÔ∏è Remove BG
            </button>
            <button class="btn btn-secondary btn-sm" onclick="alert('Connect API Key for Enhance')">
                ‚ú® Enhance
            </button>
        </div>

    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/studio_v3.js') }}"></script>
{% endblock %}