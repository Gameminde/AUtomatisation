{% extends "layout_v3.html" %}

{% block content %}
<style>
    .studio-layout {
        display: grid;
        grid-template-columns: 260px 1fr;
        gap: 1rem;
        height: calc(100vh - 140px);
        overflow: hidden;
    }

    /* â”€â”€ Left Panel â”€â”€ */
    .studio-left {
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .studio-left .list {
        flex: 1;
        overflow-y: auto;
        scrollbar-width: thin;
    }

    /* â”€â”€ Right Panel â”€â”€ */
    .studio-right {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 1rem;
        overflow: hidden;
        min-height: 0;
    }

    /* â”€â”€ Canvas Preview Column â”€â”€ */
    .canvas-col {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        min-height: 0;
    }

    .canvas-wrap {
        flex: 1;
        min-height: 0;
        display: flex;
        align-items: flex-start;
        justify-content: center;
    }

    #live-canvas {
        border-radius: 8px;
        border: 1px solid var(--border);
        max-height: 100%;
        max-width: 100%;
        object-fit: contain;
        cursor: crosshair;
    }

    /* â”€â”€ Template Strip â”€â”€ */
    .tpl-strip {
        display: flex;
        gap: 5px;
        overflow-x: auto;
        padding: 3px 0;
        scrollbar-width: thin;
        flex-shrink: 0;
    }

    .tpl-item {
        min-width: 50px;
        max-width: 50px;
        height: 62px;
        border-radius: 6px;
        border: 2px solid transparent;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.15s;
        flex-shrink: 0;
    }

    .tpl-item:hover {
        border-color: rgba(255, 255, 255, 0.2);
    }

    .tpl-item.active {
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(68, 241, 166, 0.25);
    }

    .tpl-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .tpl-item .tpl-fallback {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        opacity: 0.3;
        background: rgba(255, 255, 255, 0.03);
    }

    /* â”€â”€ Form Column â”€â”€ */
    .form-col {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        overflow-y: auto;
        min-height: 0;
        scrollbar-width: thin;
    }

    .form-col label {
        display: block;
        font-size: 0.7rem;
        color: var(--text-dim);
        margin-bottom: 1px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .form-col .input {
        font-size: 0.85rem;
    }

    .form-col .textarea {
        min-height: 80px;
        resize: vertical;
        font-size: 0.85rem;
    }

    .form-row {
        display: flex;
        gap: 0.4rem;
        align-items: center;
    }

    .upload-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        padding: 0.4rem 0.7rem;
        border-radius: 8px;
        border: 1px dashed var(--border);
        background: transparent;
        color: var(--text-dim);
        cursor: pointer;
        font-size: 0.75rem;
        font-family: inherit;
        transition: all 0.2s;
    }

    .upload-btn:hover {
        border-color: var(--primary);
        color: var(--primary);
        background: rgba(68, 241, 166, 0.05);
    }

    .color-pick {
        width: 28px;
        height: 28px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        padding: 0;
        background: transparent;
    }

    .action-bar {
        display: flex;
        gap: 0.3rem;
        flex-wrap: wrap;
        padding-top: 0.4rem;
        border-top: 1px solid var(--border);
        margin-top: auto;
    }

    .action-bar .btn {
        font-size: 0.75rem;
        padding: 0.35rem 0.6rem;
    }

    @media (max-width: 1100px) {
        .studio-right {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 900px) {
        .studio-layout {
            grid-template-columns: 1fr;
            height: auto;
        }
    }
</style>

<div class="studio-layout">
    <!-- LEFT: Content List -->
    <div class="card studio-left">
        <div style="display:flex; gap:0.4rem; margin-bottom:0.5rem;">
            <input id="search-input" class="input" placeholder="Search..." style="flex:1; font-size:0.8rem;">
            <select id="status-filter" class="input" style="max-width:90px; font-size:0.8rem;">
                <option value="">All</option>
                <option value="waiting_approval">Pending</option>
                <option value="published">Published</option>
            </select>
        </div>
        <div class="list" id="content-list"></div>
    </div>

    <!-- RIGHT: Editor -->
    <div class="card studio-right">
        <!-- Canvas Column -->
        <div class="canvas-col">
            <div class="canvas-wrap">
                <canvas id="live-canvas" width="1080" height="1350"></canvas>
            </div>
            <!-- Template Strip -->
            <div>
                <div
                    style="font-size:0.65rem; color:var(--text-dim); font-weight:700; margin-bottom:2px; text-transform:uppercase; letter-spacing:0.5px;">
                    <i class="fa-solid fa-swatchbook"></i> Templates
                </div>
                <div id="template-grid" class="tpl-strip"></div>
            </div>
        </div>

        <!-- Form Column -->
        <div class="form-col">
            <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:0.3rem;">
                <span class="muted" id="content-id" style="font-weight:600; font-size:0.8rem;">Select content â†’</span>
                <div style="display:flex; gap:0.25rem;">
                    <button class="btn btn-ghost" onclick="rejectContent()"
                        style="font-size:0.7rem; padding:0.3rem 0.5rem;" title="Reject">âœ•</button>
                    <button class="btn btn-primary-outline" onclick="regenerateContent()"
                        style="font-size:0.7rem; padding:0.3rem 0.5rem;" title="Regenerate">âŸ³</button>
                    <button class="btn btn-primary" onclick="approveContent()"
                        style="font-size:0.7rem; padding:0.3rem 0.5rem;" title="Approve">âœ“</button>
                </div>
            </div>

            <div>
                <label>Title / Hook</label>
                <input id="hook-input" class="input" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†Ø´ÙˆØ±..." oninput="renderCanvas()">
            </div>

            <div style="flex:1; display:flex; flex-direction:column;">
                <label>Caption</label>
                <textarea id="text-input" class="textarea" placeholder="Ù†Øµ Ø§Ù„Ù…Ù†Ø´ÙˆØ±..."
                    oninput="renderCanvas()"></textarea>
            </div>

            <div>
                <label>Hashtags</label>
                <input id="hashtags-input" class="input" placeholder="#ØªÙ‚Ù†ÙŠØ© #Ø£Ø®Ø¨Ø§Ø±">
            </div>

            <!-- Image Controls -->
            <div>
                <label>Background Image</label>
                <div class="form-row">
                    <button class="upload-btn" onclick="document.getElementById('bg-upload').click()">
                        <i class="fa-solid fa-image"></i> Upload BG
                    </button>
                    <button class="upload-btn" onclick="document.getElementById('photo-upload').click()">
                        <i class="fa-solid fa-camera"></i> Upload Photo
                    </button>
                    <input type="file" id="bg-upload" accept="image/*" style="display:none"
                        onchange="handleBgUpload(event)">
                    <input type="file" id="photo-upload" accept="image/*" style="display:none"
                        onchange="handlePhotoUpload(event)">
                </div>
            </div>

            <div>
                <label>Text Color</label>
                <div class="form-row">
                    <input type="color" id="text-color" value="#ffc832" class="color-pick" onchange="renderCanvas()">
                    <span class="muted" style="font-size:0.75rem;" id="color-label">#FFC832</span>
                </div>
            </div>

            <!-- Actions -->
            <div class="action-bar">
                <button class="btn btn-ghost" onclick="exportCanvas()" title="Download PNG">
                    <i class="fa-solid fa-download"></i> Export
                </button>
                <button class="btn btn-ghost" onclick="saveContent()">ðŸ’¾ Save</button>
                <button class="btn btn-primary" onclick="publishContent()">ðŸš€ Publish</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/studio_v3.js') }}"></script>
{% endblock %}